---
- name: "module_rax"
  hosts: all
  # hosts: localhost, Define the --limit localhost.
  # connection: Define the variable ansible_connection in the inventory
  # become: Define the variable ansible_become in the inventory
  # gather_facts: Define the variable ansible_gather_facts in the inventory
  vars:
    rax: 
      files: "{{ rax_files | default(omit, True) }}"
      tenant_name: "{{ rax_tenant_name | default(omit, True) }}"
      image: "{{ rax_image | default(omit, True) }}"
      user_data: "{{ rax_user_data | default(omit, True) }}"
      meta: "{{ rax_meta | default(omit, True) }}"
      flavor: "{{ rax_flavor | default(omit, True) }}"
      networks: "{{ rax_networks | default(omit, True) }}"
      auth_endpoint: "{{ rax_auth_endpoint | default(omit, True) }}"
      boot_from_volume: "{{ rax_boot_from_volume | default(omit, True) }}"
      group: "{{ rax_group | default(omit, True) }}"
      exact_count: "{{ rax_exact_count | default(omit, True) }}"
      disk_config: "{{ rax_disk_config | default(omit, True) }}"
      state: "{{ rax_state | default(omit, True) }}"
      env: "{{ rax_env | default(omit, True) }}"
      key_name: "{{ rax_key_name | default(omit, True) }}"
      boot_volume_size: "{{ rax_boot_volume_size | default(omit, True) }}"
      config_drive: "{{ rax_config_drive | default(omit, True) }}"
      boot_volume_terminate: "{{ rax_boot_volume_terminate | default(omit, True) }}"
      auto_increment: "{{ rax_auto_increment | default(omit, True) }}"
      count_offset: "{{ rax_count_offset | default(omit, True) }}"
      boot_volume: "{{ rax_boot_volume | default(omit, True) }}"
      wait_timeout: "{{ rax_wait_timeout | default(omit, True) }}"
      instance_ids: "{{ rax_instance_ids | default(omit, True) }}"
      credentials: "{{ rax_credentials | default(omit, True) }}"
      wait: "{{ rax_wait | default(omit, True) }}"
      count: "{{ rax_count | default(omit, True) }}"
      api_key: "{{ rax_api_key | default(omit, True) }}"
      name: "{{ rax_name | default(omit, True) }}"
      identity_type: "{{ rax_identity_type | default(omit, True) }}"
      extra_client_args: "{{ rax_extra_client_args | default(omit, True) }}"
      region: "{{ rax_region | default(omit, True) }}"
      username: "{{ rax_username | default(omit, True) }}"
      tenant_id: "{{ rax_tenant_id | default(omit, True) }}"
      validate_certs: "{{ rax_validate_certs | default(omit, True) }}"
      extra_create_args: "{{ rax_extra_create_args | default(omit, True) }}"
  tasks:
    - name: "plugin_rax"
      rax: "{{ rax }}"
      register: r_rax

    - name: "export r_rax"
      set_stats:
        data:
          r_rax: "{{ r_rax }}"
